# Has my account & relevant details
---
- name: create main user
  ansible.builtin.user:
    name: kwkaiser
    state: present
    comment: Karl's account
    shell: /bin/bash
    append: true
    groups:
      - sudo

- name: create ssh dir if missing
  ansible.builtin.file:
    dest: /home/kwkaiser/.ssh/authorized_keys
    mode: '0700'
    state: directory 
    owner: kwkaiser
    group: kwkaiser

- name: create keys dir if missing
  ansible.builtin.file:
    dest: /home/kwkaiser/.ssh/authorized_keys
    mode: '0600'
    state: directory 
    owner: kwkaiser
    group: kwkaiser

- name: add empty homelab ssh key
  ansible.builtin.file:
    dest: /home/kwkaiser/.ssh/authorized_keys/box
    mode: '0600'
    owner: kwkaiser
    group: kwkaiser 
    state: touch

- name: copy homelab ssh key content
  ansible.builtin.lineinfile:
    path: /home/kwkaiser/.ssh/authorized_keys/box
    regexp: '.*'
    line: "{{box_pubkey}}\n"